---
title: Análisis exploratorio de un conjunto de datos de indicadores urbanos
author:
  - name: Rebeca Company
    affil: 1,2,\dagger
  - name: Alejandro Dionis
    affil: 1,3,\dagger
  - name: Gabriel Ivars
    affil: 1,4,\dagger
  - name: Julio Garcia
    affil: 1,5,\dagger
affiliation:
  - num: 1
    address: |
      Universitat de València -
      ETSE-UV, Avinguda de l'Universitat, 46100 Burjassot, Valencia
  - num: 2
    address: |
      Máster Universitario en Ciencia de Datos
    email: recombar@alumni.uv.es
  - num: 3
    address: |
      Máster Universitario en Ciencia de Datos
    email: adioros@alumni.uv.es
  - num: 4
    address: |
      Máster Universitario en Ciencia de Datos
    email: gaia2@alumni.uv.es
  - num: 5
    address: |
      Máster Universitario en Ciencia de Datos
    email: jugarbus@alumni.uv.es    
# author citation list in chicago format
authorcitation: |
  Company, R.; Dionis, A.; Ivars, G.; Garcia, J.
# firstnote to eighthnote
firstnote: |
  Todos los autores contribuyeron de manera equitativa a este trabajo.
correspondence: |
  etse@uv.es; Tel.: +34-963-54-3211.
  
# document options
journal: Universitat de València
type: article
status: submit
# front matter
simplesummary: |
  El presente artículo es un proyecto de la Asignatura Análisis Exploratorio de Datos, en el que se realiza un análisis exploratorio del conjunto de datos de Indicadores Urbanos, publicado por el Instituto Nacional de Estadística.
abstract: |
  REDACTAR MÁS TARDE
# back matter
keywords: |
  Indicadores Urbanos; Tasa ; Población; REVISAR MAS TARDE
authorcontributions: |
    Todos los autores contribuyeron de manera equitativa a este trabajo.
funding: |
  This research received no external funding.
dataavailability: |
  Los conjuntos de datos analizados en el presente artículo están disponibles en la sección "Indicadores Urbanos. Últimos datos." del repositorio público de conjuntos de datos abiertos del Instituto Nacional de Estadística INEbase
  \url{https://www.ine.es/dyngs/INEbase/listaoperaciones.htm}.
conflictsofinterest: |
  Los autores declaran no tener ningún conflicto de interés
abbreviations:
  - short: MDPI
    long: Multidisciplinary Digital Publishing Institute
  - short: INE
    long: Instituto Nacional de Estadística
  - short: RMT
    long: REVISAR MAS TARDE
bibliography: mybibfile.bib
appendix: appendix.tex
# To use endnotes, change endnotes: true , then use \endnote{This 28 is an endnote.}.
endnotes: false
output: 
  rticles::mdpi_article:
    extra_dependencies: longtable
---


```{r setup, include=FALSE, fig.align='left'}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, out.width = '70%')
```



# Introducción

Hablar de los 3 datasets y de donde se han obtenido. BLABLABLA



# Objetivos



# Análisis exploratorio de los datos



## Importación de los datos

```{r, include=FALSE}
rm(list = ls())
pacman::p_load(readr, tidyverse, ggplot2, dplyr, plotly, lubridate) # verifica si los paquetes están instalados y, si no lo están, los instala y luego los carga
```


```{r, include=FALSE}
getOption("encoding")
guess_encoding("./data/demograficos.csv")
guess_encoding("./data/economicos.csv")
guess_encoding("./data/sociales.csv")
#El encoding es de UTF-8
```


```{r, include=FALSE}
dem <- read_delim("./data/demograficos.csv", delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE, show_col_types = FALSE)

eco <- read_delim("./data/economicos.csv", delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE, show_col_types = FALSE)

soc <- read_delim("./data/sociales.csv", delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE, show_col_types = FALSE)
```




```{r, include=FALSE}
#La variable Total del dataset social es de tipo character cuando debería ser numérica.
soc <- soc %>%
  mutate(Total = str_replace_all(Total, "\\.", "")) %>%  # Eliminar separadores de miles
  mutate(Total = str_replace_all(Total, ",", ".")) %>%   # Cambiar comas por puntos
  mutate(Total = as.numeric(Total))                      # Transformar a tipo numérico
```


```{r, include=FALSE}
#Al modificar el tipo de la variable Total se aprecia un aumento del número de valores faltantes. Exploremos los posibles motivos. 

df_ori <- read_delim("./data/sociales.csv", delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",", grouping_mark = "."), trim_ws = TRUE)

na_diff <- which(!is.na(df_ori$Total) & is.na(soc$Total))
diff_observations <- df_ori[na_diff, , drop = FALSE]
diff_observations

# Hay 1461 observaciones en el dataframe social con un valor de ".." en la variable Total
```



```{r, include=FALSE}
# Transformar variable Periodo a tipo fecha y extraer solo el año

dem <- dem %>%
  mutate(Periodo = year(ymd(paste0(Periodo, "-01-01"))))

eco <- eco %>%
  mutate(Periodo = year(ymd(paste0(Periodo, "-01-01"))))

soc <- soc %>%
  mutate(Periodo = year(ymd(paste0(Periodo, "-01-01"))))
```



```{r, include=FALSE}
# Los datos faltantes en la variable Municipios son los valores asociados a Total Nacional. Por lo que se va a eliminar la columna Total Nacional y se van a rellenar los NA con el Valor "Total Nacional".

dem_2<- dem %>% replace_na(list(Municipios = "Total Nacional")) %>% select(-"Total Nacional")
eco_2<- eco %>% replace_na(list(Municipios = "Total Nacional")) %>% select(-"Total Nacional")
soc_2<- soc %>% replace_na(list(Municipios = "Total Nacional")) %>% select(-"Total Nacional")

```



```{r, include=FALSE}
# Se concatenan los 3 datasets ya que tienen formato tidy y no hay coincidencias en la variable 'Indicadores', que es común a todos los dataframes.
full_df <- bind_rows(dem_2, eco_2, soc_2)
```




```{r, include=FALSE}
# Datos Totales Nacionales (Sexo=Total)
total_df <- full_df %>% filter(Municipios=='Total Nacional') %>% filter(Sexo=='Total') %>% select(-Sexo)

# Datos Totales Nacionales por sexo
total_bysex_df <- full_df %>% filter(Municipios=='Total Nacional') %>% filter(Sexo!='Total') 


# Datos por municipios (Sexo=Total)
mun_df <- full_df %>% filter(Municipios!='Total Nacional') %>% filter(Sexo=='Total') %>% select(-Sexo)

# Datos por municipios y sexo
mun_bysex_df <- full_df %>% filter(Municipios!='Total Nacional') %>% filter(Sexo!='Total') 
```



```{r, include=FALSE}
# Formato ancho de los dataframes
wide_full_df <- full_df %>% pivot_wider(names_from="Indicadores", values_from="Total")

wide_total_df <- total_df %>% pivot_wider(names_from="Indicadores",
                                          values_from="Total")

wide_total_bysex_df <- total_bysex_df %>% pivot_wider(names_from="Indicadores",
                                          values_from="Total")

wide_mun_df <- mun_df %>% pivot_wider(names_from="Indicadores", values_from="Total")

wide_mun_bysex_df <- mun_bysex_df %>% pivot_wider(names_from="Indicadores", values_from="Total")
```


Antes de importar el dataset, primero se verificó que la codificación de los tres datasets fuera la misma, confirmando que todos estaban en formato UTF-8. Una vez comprobado, a la hora de importar los datasets, fue necesario establecer el delimitador de campos con el punto y coma (;) y adaptar el formato reginal al de R, ya que en los datasets el decimal_mark es la coma (,) y el grouping_mark es el punto (.). Las variables a estudiar, las cuales son coincidentes en los tres datasets, son:


- *Total Nacional* : Variable redundante con un único valor "Total Nacional", que toma verdadero valor cuando el atributo *Municipios* es vacío. 

- *Municipios* : Ciudad de la que se han obtenido los datos.

- *Indicadores* : Tipo de estadístico demográfico, económico o social que se está calculando en cada observación (se comentarán mas a fondo después del análisis de datos faltantes).

- *Sexo* : Sexo del cual se está obteniendo el indicador estadístico (hombre o mujer).

- *Periodo* : Año al que hace referencia el indicador estadístico.


- *Total* : Valor numérico asociado al indicador estadístico, que puede ser un valor absoluto, una tasa o un porcentaje, dependiendo del tipo de estadístico.



Otras consideraciones a tener en cuenta son que la variable *Total* del dataset social era de tipo character y se transformó a tipo numeric para poder realizar operaciones. Esto se debe a que esta columna contenía valores "..", que serán considerados como faltantes en nuestro análisis. Al importar estos valores, R determinó que la clase de esta variable era de tipo character.

Además, se transformó la variable *Periodo* a tipo Date.


Posteriormente se concatenaron los tres datasets ya que tienen formato tidy y no hay niveles coincidentes (todos son únicos) en la columna *Indicadores*, que es común a todos los dataframes.



Finalmente, el dataset se separó en varias partes:

- Datos totales nacionales con *Sexo* = Total.

- Datos totales nacionales por sexo.

- Datos por municipios con *Sexo* = Total.

- Datos por municipios y sexo.



Esto se hizo porque no tiene sentido estudiar los datos de forma conjunta, ya que muchos de los indicadores tienen distintas escalas. No obstante, también se ha guardado el dataset completo por si es necesario trabajar con él en algún momento.




## Análisis de datos faltantes y especiales




Los datos faltantes en la variable Municipios son los valores asociados a Total Nacional. Por lo que se va a eliminar la columna Total Nacional y se van a rellenar los NA con el Valor "Total Nacional".

Al modificar el tipo de la variable Total se aprecia un aumento del número de valores faltantes. Exploremos los posibles motivos. Debido a que Hay 1461 observaciones en el dataframe social con un valor de ".." en la variable Total



```{r, include=FALSE}
# Comprobar filas duplicadas
duplicated_rows <- full_df %>%
  filter(duplicated(full_df))

# Ver las filas duplicadas
print(duplicated_rows)
```


```{r, include=FALSE}
```


```{r, include=FALSE}
```


```{r, include=FALSE}
```


```{r, include=FALSE}
```
